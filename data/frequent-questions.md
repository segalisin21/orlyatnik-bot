# Анализ истории чатов — частые вопросы

По результатам разбора CSV с историей чатов («чаты - история (1).csv», «чаты - Лист1.csv») выделены темы и типовые формулировки.

## Частые темы (по убыванию важности)

| Тема | Примеры формулировок | Примечание |
|------|----------------------|------------|
| **Стоимость / цена** | стоимость, цена, цены, сколько стоит, какая цена | Почти в каждом диалоге |
| **Что входит / программа** | что входит, программа, что будет, что включено | Часто вместе с ценой |
| **Как записаться / забронировать** | как записаться, как забронировать, хочу записаться, готов забронировать | Переход к анкете |
| **Оплата / задаток** | как оплатить, когда оплатить, задаток, реквизиты | После анкеты |
| **Что взять с собой** | что взять, что брать, что нужно с собой | Стабильно повторяется |
| **Алкоголь** | алкоголь, пиво, привозить, можно ли | Частый бытовой вопрос |
| **Как добраться / где** | как добраться, где проходит, адрес, локация | Логистика |
| **Даты / смены** | сколько длится смена, даты, какие смены | Уточнение перед бронью |
| **Места** | места есть, сколько мест, остались ли места | Перед решением |
| **Размещение** | комната, сколько человек в комнате, мальчики девочки отдельно, с подругами в одну | Условия проживания |
| **Постельное бельё** | постельное белье дают | Короткий факт |
| **Питание** | питание, борщ, вкусно кормят | Реже |
| **Правила / безопасность** | правила, безопасность, запрещенные вещества | Важно для части аудитории |
| **Скидки** | скидка за количество, акция | Возражение по цене |
| **Расписание дня** | расписание, какие мероприятия | Детализация программы |
| **Маскарадный бал** | что нужно на маскарадный бал | Конкретная активность |
| **Конкурсы / активность** | конкурсы, что будет интересного | Программа |
| **Компания** | какой народ, компания | Сомнение «ехать одному» |
| **Презервативы / уединение** | презервативы, уединяться с девочками | Редко, но есть |
| **Душ / удобства** | помыться, душ | Бытовое |
| **Парковка / машина** | парковка, хранение авто | Для приезжающих на авто |
| **Шестая смена / сентябрь** | 6 смена будет, в сентябре | Уточнение дат |
| **Возраст / сколько человек** | возраст, сколько человек в лагере | Справочно |

## Использование базы ответов

1. **Семенная база** лежит в `data/answers-seed.csv`. Колонки: `question_normalized`, `answer`, `updated_at`.
2. В боте ответы хранятся в листе **«Ответы»** в той же структуре. Поиск: сначала точное совпадение по нормализованному вопросу, затем по вхождению (вопрос содержит ключ или ключ содержится в вопросе).
3. **Импорт семенной базы в Google-таблицу:**
   - Файл `data/answers-seed.csv` использует **табуляцию (Tab)** как разделитель — запятые в тексте ответов не мешают.
   - В Google Таблице: создай лист **«Ответы»** с колонками `question_normalized` | `answer` | `updated_at`. Файл → Импорт → Загрузить → выбери `answers-seed.csv` → в настройках импорта укажи **разделитель «Табуляция»** (не «Запятая»).
   - Полный разбор своих CSV с историей: `npm run seed:parse -- "путь/к/чаты - история (1).csv" "путь/к/чаты - Лист1.csv"` — создаст новый seed (тоже с табуляцией) и отчёт по частоте.
4. **Нормализация вопроса** в коде: нижний регистр, trim, схлопывание пробелов (`normalizeQuestion` в `sheets.ts`). Короткие ключи вроде «цена», «стоимость», «программа» подхватывают формулировки «какая цена», «что по стоимости», «расскажи про программу» и т.п.

## Запуск парсера истории (полный разбор CSV)

Из корня проекта (когда доступны Node и ts-node):

```bash
npx ts-node scripts/parse-chat-history.ts "путь/к/чаты - история (1).csv" "путь/к/чаты - Лист1.csv"
```

Скрипт создаёт:
- `data/answers-seed.csv` — все уникальные нормализованные вопросы и по одному выбранному ответу на каждый;
- `data/frequent-questions.md` — обновлённый отчёт с топом по частоте.

Текущий `data/answers-seed.csv` собран вручную по темам выше и готов к использованию в листе «Ответы».
